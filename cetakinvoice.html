<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEDULUR FOTO COPY</title>

  <link rel="icon" type="image/png" href="img/loggo/sdlr.png">
  <link rel="stylesheet" href="css/invoce.css">
</head>
<body>

<!-- ================= NAVBAR ================= -->
<header>
  <div class="logo">
    <img src="img/loggo/sdlr.png" alt="Sedulur Fotocopy Logo">
  </div>

  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="cetakfoto.html">Cetak Foto</a></li>
      <li><a href="cetakinvoice.html">Invoice</a></li>
      <li><a href="#">About Us</a></li>
      <li><a href="#" onclick="logout()">Logout</a></li>
    </ul>
  </nav>

  <div class="search-box">
    <input type="text" placeholder="Cari Produk Disini">
    <button>üîç</button>
  </div>
</header>

<!-- ================= HEADER INVOICE ================= -->
<div class="header" id="notaArea">
  <img src="img/loggo/logo1.png" class="logo">
  <div class="info">
    <small>Tanggal: <span id="tgl"></span></small><br>
    <small>No Nota: <span id="noNota"></span></small><br>
    <small>Nama: <span id="namaView">-</span></small><br>
    <small>Admin: <span id="adminName">-</span></small>
  </div>
</div>

<!-- ================= INPUT NAMA ================= -->
<div class="no-print" style="margin-bottom:10px">
  <input type="text" id="namaPelanggan" placeholder="Nama Pelanggan">
</div>

<!-- ================= INPUT ITEM ================= -->
<div class="select-area no-print">
  <select id="layanan">
    <option data-type="hp" data-bulat="true">Print Hitam Putih</option>
    <option data-type="warna">Print Warna</option>
    <option data-type="warnastandar">Print Standar</option>
    <option data-type="fullcolor">Full Color</option>

    <option value="500">Hitam Putih Bolak-Balik</option>
    <option value="4000">Full A4 HVS</option>
    <option value="8000">A3 Buffalo</option>
    <option value="10000">A3 Glossy</option>
    <option value="40000">HardCover</option>
    <option value="4000">Jilid Mika</option>
    <option value="15000">Softcover</option>
    <option value="18000">Softcover Sambung</option>
  </select>

  <input type="number" id="lembar" min="1" value="1">
  <input type="number" id="qty" min="1" value="1">
  <button onclick="tambah()">Tambah</button>
</div>

<!-- ================= TABLE ================= -->
<table>
<thead>
<tr>
  <th>Deskripsi</th>
  <th class="print-only">Harga</th>
  <th>Lembar</th>
  <th>Qty</th>
  <th class="print-only">Subtotal</th>
  <th class="no-print">Aksi</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

<!-- ================= TOTAL ================= -->
<div class="total">Total: Rp <span id="totalView">0</span></div>
<div class="grand-total">Grand Total: Rp <span id="grandTotalView">0</span></div>

<!-- ================= BUTTON ================= -->
<div class="no-print" style="margin-top:15px;display:flex;gap:10px">
  <button onclick="window.print()">Print</button>
  <button onclick="downloadPDF()">PDF</button>
  <button onclick="sendWA()">WhatsApp</button>
  <button onclick="location.reload()">Reset</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<!-- ================= SCRIPT INVOICE ================= -->
<script>
const tgl = document.getElementById("tgl");
const noNota = document.getElementById("noNota");
const namaView = document.getElementById("namaView");
const namaPelanggan = document.getElementById("namaPelanggan");
const list = document.getElementById("list");
const totalView = document.getElementById("totalView");
const grandTotalView = document.getElementById("grandTotalView");

noNota.innerText = "INV-" + Date.now();
const d = new Date();
tgl.innerText = `${d.getDate()}-${d.getMonth()+1}-${d.getFullYear()}`;

namaPelanggan.addEventListener("input", () => {
  namaView.innerText = namaPelanggan.value || "-";
});

function tambah(){
  const layanan = document.getElementById("layanan");
  const lembar = parseInt(document.getElementById("lembar").value);
  const qty = parseInt(document.getElementById("qty").value);
  const opt = layanan.options[layanan.selectedIndex];
  const harga = parseInt(opt.value) || 300;

  const sub = harga * lembar * qty;
  const tr = document.createElement("tr");
  tr.dataset.sub = sub;

  tr.innerHTML = `
    <td>${opt.text}</td>
    <td class="print-only">${harga.toLocaleString()}</td>
    <td>${lembar}</td>
    <td>${qty}</td>
    <td class="print-only">${sub.toLocaleString()}</td>
    <td class="no-print"><span onclick="this.closest('tr').remove(); hitung()">Hapus</span></td>
  `;
  list.appendChild(tr);
  hitung();
}

function hitung(){
  let total = 0;
  document.querySelectorAll("#list tr").forEach(tr=>{
    total += parseInt(tr.dataset.sub);
  });
  totalView.innerText = total.toLocaleString();
  grandTotalView.innerText = total.toLocaleString();
}

function downloadPDF(){
  html2pdf().from(document.getElementById("notaArea")).save();
}

function sendWA(){
  window.open(`https://wa.me/6288980484642?text=${encodeURIComponent(
    "Nota Sedulur Fotocopy\nAdmin: "+document.getElementById("adminName").innerText+
    "\nNama: "+namaView.innerText+
    "\nTotal: Rp "+grandTotalView.innerText
  )}`);
}
</script>

<!-- ================= FIREBASE AUTH ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCzk9nMICnFTHaF8_xvGoWuyUuKiP-dS1Y",
  authDomain: "sedulur-fotocopy-unnes.firebaseapp.com",
  projectId: "sedulur-fotocopy-unnes",
  storageBucket: "sedulur-fotocopy-unnes.firebasestorage.app",
  messagingSenderId: "899088194781",
  appId: "1:899088194781:web:597f1fd8766e9b71dd8f34"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

onAuthStateChanged(auth, (user)=>{
  if(user){
    document.getElementById("adminName").innerText =
      user.displayName || user.email;
  }else{
    window.location.href = "login.html";
  }
});

window.logout = function(){
  signOut(auth).then(()=>{
    window.location.href = "login.html";
  });
}
</script>

</body>
</html>
